From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: NostrC Overlay <overlay@example.com>
Date: Mon, 15 Sep 2025 20:55:00 -0400
Subject: [PATCH] goabackend: add Nostr provider (user overlay)

This adds a minimal Nostr provider under providers/nostr and wires it into
src/goabackend/meson.build. The plugin identifies as provider type "nostr"
and enables Calendar, Contacts, and Files services by default.

The overlay build installs the plugin and icon assets into ~/.local. This
patch is consumed by the nostr-goa-overlay build wrapper; the base system
GOA is not modified.
---
 src/goabackend/meson.build                     |  1 +
 src/goabackend/providers/nostr/meson.build     | 24 ++++++++++++++++++++++++
 src/goabackend/providers/nostr/goanostr.c      | 31 ++++++++++++++++++++++++++
 src/goabackend/providers/nostr/icons/meson.build | 12 +++++++++++
 4 files changed, 68 insertions(+)
 create mode 100644 src/goabackend/providers/nostr/meson.build
 create mode 100644 src/goabackend/providers/nostr/goanostr.c
 create mode 100644 src/goabackend/providers/nostr/icons/meson.build

diff --git a/src/goabackend/meson.build b/src/goabackend/meson.build
index 0000000..1111111 100644
--- a/src/goabackend/meson.build
+++ b/src/goabackend/meson.build
@@ -1,3 +1,4 @@
 subdir('providers/google')
 subdir('providers/microsoft')
+subdir('providers/nostr')
 
diff --git a/src/goabackend/providers/nostr/meson.build b/src/goabackend/providers/nostr/meson.build
new file mode 100644
index 0000000..2222222
--- /dev/null
+++ b/src/goabackend/providers/nostr/meson.build
@@ -0,0 +1,24 @@
+nostr_provider_sources = [
+  'goanostr.c',
+]
+
+shared_module('goa-nostr', nostr_provider_sources,
+  name_prefix: '',
+  dependencies: [goa_backend_dep, glib_dep, gobject_dep, gio_dep],
+  install: true,
+  install_dir: join_paths(get_option('libdir'), 'goa-1.0', 'backends')
+)
+
+subdir('icons')
+
+install_data(
+  'icons/hicolor/scalable/apps/goa-nostr.svg',
+  install_dir: join_paths(get_option('datadir'), 'icons', 'hicolor', 'scalable', 'apps')
+)
+
+meson.add_install_script('sh', '-c', 'true')
+
diff --git a/src/goabackend/providers/nostr/goanostr.c b/src/goabackend/providers/nostr/goanostr.c
new file mode 100644
index 0000000..3333333
--- /dev/null
+++ b/src/goabackend/providers/nostr/goanostr.c
@@ -0,0 +1,31 @@
+#include <glib.h>
+#include <gio/gio.h>
+#include <goa/goabackend.h>
+#include <goa/goabackendprovider.h>
+
+typedef struct {
+  GoaProvider parent_instance;
+} GoaNostr;
+
+G_DEFINE_TYPE(GoaNostr, goa_nostr, GOA_TYPE_PROVIDER)
+
+static const gchar *get_type_id(GoaProvider *provider) { (void)provider; return "nostr"; }
+static const gchar *get_name(GoaProvider *provider) { (void)provider; return "Nostr"; }
+
+static gboolean build_object(GoaProvider *provider, GoaObjectSkeleton *object, GKeyFile *kf, const gchar *group, GError **error){
+  (void)provider; (void)kf; (void)group; (void)error;
+  GoaAccount *acc = goa_object_skeleton_get_account(object);
+  if (!acc) { acc = goa_account_skeleton_new(); goa_object_skeleton_set_account(object, acc); g_object_unref(acc); }
+  goa_account_set_provider_type(acc, "nostr");
+  goa_account_set_provider_name(acc, "Nostr");
+  goa_account_set_calendar_disabled(acc, FALSE);
+  goa_account_set_contacts_disabled(acc, FALSE);
+  goa_account_set_files_disabled(acc, FALSE);
+  goa_account_set_mail_disabled(acc, TRUE);
+  return TRUE;
+}
+
+static void goa_nostr_class_init(GoaNostrClass *klass){
+  GoaProviderClass *pk = GOA_PROVIDER_CLASS(klass);
+  pk->get_provider_type = get_type_id; pk->get_provider_name = get_name; pk->build_object = build_object;
+}
+static void goa_nostr_init(GoaNostr *self){ (void)self; }
+
+G_MODULE_EXPORT void goa_provider_get_types(const GType **types, gint *n_types){ static GType t[1]; static gsize i=0; if (g_once_init_enter(&i)){ t[0]=goa_nostr_get_type(); g_once_init_leave(&i,1);} *types=t; *n_types=1; }
+
+
diff --git a/src/goabackend/providers/nostr/icons/meson.build b/src/goabackend/providers/nostr/icons/meson.build
new file mode 100644
index 0000000..4444444
--- /dev/null
+++ b/src/goabackend/providers/nostr/icons/meson.build
@@ -0,0 +1,12 @@
## Install scalable icon; the overlay can complement with more sizes
install_data(
  'hicolor/scalable/apps/goa-nostr.svg',
  install_dir: join_paths(get_option('datadir'), 'icons', 'hicolor', 'scalable', 'apps')
)
+
