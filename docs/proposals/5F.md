# NIP-5F

Remote Signing via Unix Domain Sockets
--------------------------------------

`draft` `optional`

This NIP defines a protocol for communication between Nostr clients and local remote signers using Unix domain sockets. This enables secure, local-only signing without exposing private keys to client applications.

Unix domain sockets provide several advantages for local signing:

1. They're local-only by design, preventing network exposure of sensitive operations
2. They offer lower latency than network-based solutions
3. They work without internet connectivity

## Protocol Overview

This protocol defines how a Nostr client can request event signing from a local signer service through Unix domain sockets.

### Socket Location

The socket should be located at:

```
$HOME/.local/share/nostr/signer.sock
```

### Connection Handshake

Upon connecting to the socket, the signer should send a handshake message:

```json
{
  "name": "nostr-signer",
  "supported_methods": ["get_public_key", "sign_event", "nip44_encrypt", "nip44_decrypt", "list_public_keys"]
}
```

The client should respond with:

```json
{ "client": "client-name" }
```

### Request Format

All requests follow this JSON-RPC-like format:

```json
{
  "id": "<random_string>",
  "method": "<method_name>",
  "params": [<array_of_parameters>]
}
```

### Response Format

All responses follow this format:

```json
{
  "id": "<same_id_from_request>",
  "result": <result_value>,
  "error": null
}
```

Or in case of an error:

```json
{
  "id": "<same_id_from_request>",
  "result": null,
  "error": {
    "code": <error_code>,
    "message": "<error_message>"
  }
}
```

### Methods

- `get_public_key`: params `[]` → result `<32-byte-hex-encoded-pubkey>` (or npub if you decide; be consistent)
- `sign_event`: params `[ {kind,content,tags,created_at}, "pubkey" ]` → result `signed_event_object`
- `nip44_encrypt`: params `[ "pubkey", "plaintext" ]` → result `"<cipher_b64>"`
- `nip44_decrypt`: params `[ "pubkey", "<cipher_b64>" ]` → result `"<plaintext>"`
- `list_public_keys`: params `[]` → result `[ {"pubkey":"...","name":"..."}, ... ]`

## Transport

- Framing: 4-byte big-endian length prefix, followed by that many bytes of UTF-8 JSON, max 1 MiB.
- Socket: `${HOME}/.local/share/nostr/signer.sock` (override `NOSTR_SIGNER_SOCK`).
- Permissions: directory 0700; socket mode 0600.
- Concurrency: multiple clients; one reader per connection; per-client token bucket (10 rps, burst 20 recommended).
- Peer identity: use SO_PEERCRED on Linux.

## Errors

Standard error codes:

- 1: Invalid request format
- 2: Method not supported
- 3: Invalid parameters
- 4: Key not found
- 5: User declined to sign
- 10: Internal error
