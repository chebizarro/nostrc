# NIP-55L

## Linux Signer Application

`draft` `optional`

This NIP describes a method for 2-way communication between a Linux-based Nostr signer application and any Nostr client running on Linux. The Linux signer application uses DBus to communicate between applications, enabling secure signing, encryption, and decryption operations.

## Why DBus for IPC?

DBus (Desktop Bus) is an established IPC system designed for Linux, providing a simple way for applications to communicate with one another in a secure, structured environment. Here’s why DBus is particularly suitable for the Linux Signer Application:

1. System-wide and User Session Access: DBus allows services to be accessed at the system or user session level. The Linux signer app can be configured as a session bus service, making it accessible to applications running in the user’s session without exposing it to the entire system.
2. Security and Permissions Management: DBus has built-in security features and can be configured with policies that control which applications can access certain methods. This is critical for sensitive operations such as signing and encryption, where unauthorized access could lead to compromise of private keys.
3. Compatibility with Sandboxing: DBus is compatible with sandboxed applications, such as those running in Flatpak or Snap. By configuring the appropriate permissions, DBus calls can traverse sandbox boundaries, allowing secure, restricted access to the signer from otherwise isolated applications.
4. Standardization and Integration: DBus is widely used in Linux environments and is well-supported in most desktop environments. This makes it a standardized choice for IPC, ensuring good compatibility and reducing complexity for developers building applications that interact with the signer.

## DBus Interface Specification

The Linux Signer app exposes its functionality over DBus using the following interface, which enables external applications to request cryptographic operations securely.

### DBus XML Specification

```xml
<node>
	<interface name="org.nostr.Signer">
		<!-- Get Public Key -->
		<method name="GetPublicKey">
			<arg type="s" direction="out" name="npub" />
		</method>

		<!-- Sign Event -->
		<method name="SignEvent">
			<arg type="s" direction="in" name="eventJson" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="in" name="app_id" />
			<arg type="s" direction="out" name="signature" />
		</method>

		<!-- NIP-04 Encrypt -->
		<method name="NIP04Encrypt">
			<arg type="s" direction="in" name="plaintext" />
			<arg type="s" direction="in" name="pubKey" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="out" name="encryptedText" />
		</method>

		<!-- NIP-04 Decrypt -->
		<method name="NIP04Decrypt">
			<arg type="s" direction="in" name="encryptedText" />
			<arg type="s" direction="in" name="pubKey" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="out" name="plaintext" />
		</method>

		<!-- NIP-44 Encrypt -->
		<method name="NIP44Encrypt">
			<arg type="s" direction="in" name="plaintext" />
			<arg type="s" direction="in" name="pubKey" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="out" name="encryptedText" />
		</method>

		<!-- NIP-44 Decrypt -->
		<method name="NIP44Decrypt">
			<arg type="s" direction="in" name="encryptedText" />
			<arg type="s" direction="in" name="pubKey" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="out" name="plaintext" />
		</method>

		<!-- Decrypt Zap Event -->
		<method name="DecryptZapEvent">
			<arg type="s" direction="in" name="eventJson" />
			<arg type="s" direction="in" name="current_user" />
			<arg type="s" direction="out" name="decryptedEvent" />
		</method>

		<!-- Get Relays -->
		<method name="GetRelays">
			<arg type="s" direction="out" name="relaysJson" />
		</method>
	</interface>
</node>
```

## Sandboxing Considerations: Flatpak and Snap

1. DBus Permissions for Flatpak:

```json
"finish-args": [
    "--talk-name=org.nostr.Signer"
]
```

2. DBus Permissions for Snap:

```yaml
plugs:
  nostr-signer:
    interface: dbus
    bus: session
    name: org.nostr.Signer
```

3. Security Policies and User Prompts: signer maintains ACL at ~/.config/nostr-signer/acl.json and may prompt the user.

4. Session Isolation: session bus only by default.

## Example Usage

```bash
#!/bin/bash

event_json='{"id":"event_id","content":"Hello from Nostr!"}'
current_user="user_id"
app_id="app_id_example"

dbus-send --session --dest=org.nostr.Signer --print-reply /org/nostr/signer org.nostr.Signer.SignEvent \
  string:"$event_json" string:"$current_user" string:"$app_id"
```
