{"id":"nostrc-otq","title":"Fix use-after-free in async HTTP callbacks","description":"Fixed heap corruption caused by accessing user_data in async callbacks before checking if the request was cancelled. When a widget is destroyed while an HTTP request is pending, the cancellable is cancelled but the callback still fires with a dangling pointer.\n\nFixed in:\n- gnostr-image-viewer.c: on_image_loaded\n- note_card_row.c: on_video_thumb_bytes_ready\n\nPattern: Check soup_session_send_and_read_finish() result BEFORE casting/accessing user_data. If cancelled, return immediately without touching user_data.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-28T11:11:39.591939-08:00","updated_at":"2026-01-28T11:11:39.591939-08:00","labels":["async","crash","memory-safety"]}
{"id":"nostrc-wsn","title":"Fix async callback use-after-free pattern across all UI widgets","description":"ASAN identified a systemic use-after-free pattern in async callbacks across 22 UI files. When widgets are disposed while async operations are in flight, the callbacks fire and access freed memory.\n\n**Root Cause:**\nAsync callbacks (GAsyncReadyCallback) access `user_data` (the widget pointer) without checking if the widget has been freed. The pattern `GNOSTR_IS_NOTE_EMBED(self)` doesn't detect freed memory.\n\n**Fix Pattern:**\n1. Call the finish function FIRST to get the error\n2. Check if error is G_IO_ERROR_CANCELLED - if so, return immediately without accessing user_data\n3. Only then cast user_data to the widget type\n\n**Files affected (56 callbacks across 22 files):**\n- gnostr-main-window.c (9)\n- gnostr-login.c (5)\n- gnostr-profile-pane.c (5)\n- gnostr-zap-dialog.c (4)\n- note_card_row.c (4)\n- gnostr-dm-service.c (3)\n- gnostr-image-viewer.c (3)\n- gnostr-thread-view.c (3)\n- gnostr-avatar-cache.c (2)\n- gnostr-emoji-content.c (2)\n- gnostr-nip7d-thread-view.c (2)\n- gnostr-note-embed.c (2) - FIXED\n- gnostr-nwc-connect.c (2)\n- og-preview-widget.c (2)\n- And 8 more files with 1 callback each\n\n**Already fixed:**\n- gnostr-note-embed.c: on_relay_query_done, on_profile_relay_query_done\n- gnostr-avatar-cache.c: Using weak references","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-27T22:08:06.410583-08:00","created_by":"bizarro","updated_at":"2026-01-27T22:08:06.410583-08:00","labels":["async","crash","gtk4","use-after-free"]}
